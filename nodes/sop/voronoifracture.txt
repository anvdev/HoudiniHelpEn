#type: node
#context: sop
#icon: SOP/voronoifracture
#internal: voronoifracture
#version: 2.0

#tags: break

= Voronoi Fracture =

"""Fractures the input geometry by performing a Voronoi decomposition of space around the input cell points"""

The Voronoi Fracture SOP takes two primary inputs: the mesh to fracture, and the points around which to build each Voronoi cell. Often these points will be generated by either the [Scatter SOP|Node:sop/scatter], or the [Points From Volume SOP|Node:sop/pointsfromvolume], but any source of points will work.
For a solid fracture (where the interior surface of the object is built for each piece) it is very useful to have all the points reside within the volume, in which case one fractured piece will be generated for for each cell point.

== Tips ==

- Using points scattered in a density volume generated from the geometry using [IsoOffset|Node:sop/isooffset] is a flexible way to generate cell points, as you can modulate the density in the volume before scattering to get more points within particular regions of the object.
Where there is higher point density, the Fracture SOP will generate more, smaller pieces.
- Mesh complexity slows down fracturing more than anything. PolyReduce before fracturing if you can.
- If you have problems with insufficient point density in long appendages or something in the input object, try [scattering|Node:sop/scatter] points after using [IsoOffset|Node:sop/isooffset] and scaling the density up in those areas.
- The [RBD Interior Detail SOP|Node:sop/rbdinteriordetail] can be used to create high resolution pieces with detailed interior surfaces.
- The [RBD Cluster SOP|Node:sop/rbdcluster] can be used to create larger clusters from the fractured pieces.

@inputs

Geometry to Fracture:
    The polygonal geometry that will be fractured according to the Voronoi decomposition.

Points for Voronoi Cells:
    Input points, where each point represents a Voronoi cell around which to fracture the geometry.

@outputs

Fractured Geometry:
    The fractured polygonal geometry.

Constraint Geometry:
    Geometry containing a point for each piece, and polygon lines connecting pieces that are adjacent. This is useful for creating a [constraint network|Node:dop/constraintnetwork].

@parameters

Group:
    The geometry to be fractured.
    If no group is specified, the full input geometry will be fractured.

=== Pieces ===

Create Interior Surfaces:
    Creates faces on the interior of the geometry when performing the cutting.
    This should typically be disabled when fracturing open surfaces, or to create a thin shell from a solid object.

Name Attribute:
    #id: namemethod
    Specifies how the `name` primitive attribute (which identifies the primitives belonging to each piece) is created.

    Overwrite:
        Constructs the name by combining the __Name Prefix__ with the piece number.
    Append:
        If the original geometry already has a `name` primitive attribute, the __Name Prefix__ and piece number are appended to it.
        This is useful when performing multiple levels of fracturing.

Name Prefix:
    #id: nameprefix
    The prefix applied to the name of each piece created by the fracture.

Compute Interior Normals:
    #id: computeinteriornormals
    Computes vertex normals on the edges of the interior geometry, so that they will have a cusped appearance.

Interior Cusp Angle:
    #id: interiorcuspangle
    Computes vertex normals on the edges of the interior geometry with angles greater than this angle, so that they will have a cusped appearance.

Exterior Normals:
    #id: computeexteriornormals
    Specifies how to compute or update vertex normals for the input geometry.

    Preserve Existing Normals:
        Only compute vertex normals if the input geometry does not already have normals.

    Recompute Normals:
        Always compute vertex normals for the input geometry.

    Do Not Compute Normals:
        Do not compute normals for the input geometry. If __Compute Interior Normals__ is still enabled, though, smooth normals will be computed.

Exterior Cusp Angle:
    #id: exteriorcuspangle
    Computes vertex normals on the edges of the input geometry with angles greater than this angle, so that they will have a cusped appearance.

=== Output Attributes ===

Attribute Name Prefix:
    #id: attribnameprefix
    Specifies a prefix for the attribute or group names specified by the __Primitive Piece__, __Primitive Cell Point__, __Primitive Clip Piece__, __Interior Group__, and __Exterior Group__ parameters.
    This can make it easier to create unique attribute names when performing multiple levels of fracturing.

Primitive Piece:
    #id: pieceattrib
    The name of the attribute containing the piece number with which each primitive is associated.

Primitive Cell Point:
    The name of the attribute on primitives that will store which of the fracture points it comes from.

Primitive Clip Piece:
    The name of the attribute on interior surface primitives that corresponds to the other piece adjacent at that surface.

Interior Group:
    #id: interiorgroup
    The group containing any primitives in the interior surfaces created during fracturing.

Exterior Group:
    #id: exteriorgroup
    The group containing the primitives in the original input geometry.

Merge with Existing Groups:
    #id: mergegroups
    If the interior and exterior groups already exist on the geometry from a previous fracture, the new interior primitives will be added to the interior group and the original exterior group will be preserved.
    This behavior results in an interior group that contains all of the interior primitives created by multiple fracture operations (which can be useful for the [RBD Interior Detail SOP|Node:sop/rbdinteriordetail]).
    Otherwise, the interior group will be overwritten to only contain the interior primitives added by this node, and the exterior group will contain all of the input primitives.

Copy Cell Point Attributes:
    Copy attributes from the input cell points to the output piece geometry.

To Piece Points:
    The attributes to copy from the cell points to the points of the output piece geometry.

To Piece Primitives:
    The attributes to copy from the cell points to the primitives of the output piece geometry.

To Constraint Points:
    The attributes to copy from the cell points to the points of the output constraint geometry.

=== Cut ===

Triangulation:
    Auto Detect:
        Determine whether the input points are 1D, 2D, or 3D and generate a triangulation for them.
    2D:
        Assume points are 2D and triangulate.
    3D:
        Assume points are 3D and tetrahedralize.
    Use Existing:
        Use an existing triangulation on the input points.

Connectivity Partition:
    None:
        Do not further partition pieces into groups by connectivity.
    Overwrite Piece Numbering:
	    Normally each input cell point will create one output piece. However, with concave objects this can mean that disconnected pieces of geometry are placed in the same piece. 
	    Enabling this option will further divide the pieces into separate, connected groups of geometry. This option allows the piece numbers to be overwritten by this operation, which is fast and acceptable if you don't need the piece numbers to match the input point numbers.
    Maintain Piece Numbering:
        This option uses a slower algorithm to ensure that piece numbers remain consistent with input point numbers.

Cut Plane Offset:
    Offsets the cut plane between adjacent cell points before cutting.
    Increasing this has the effect of putting space between each fractured piece.

@related
    - [Node:sop/rbdinteriordetail]
    - [Shatter|/shelf/shatter]
    - [How to control the effects of voronoi fracture|/dyno/voronoifracture]
